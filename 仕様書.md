# GenAnyTone アプリケーション仕様書

## 目次
1. [概要](#1-概要)
2. [システム構成](#2-システム構成)
3. [機能仕様](#3-機能仕様)
4. [データ構造](#4-データ構造)

---

# 1. 概要

## 1.1. アプリケーションの目的
和音練習用チューナーのテスト用音波生成ツール。構成音ごとにcent単位で出力を調整できる純正律の音波ジェネレータ。

## 1.2. 利用対象者
- 和音練習用チューナーの研究者
- 純正律の音波生成が必要なユーザー

## 1.3. 用語定義

| 用語   | 説明                                         |
| ------ | -------------------------------------------- |
| 構成音 | 和音を構成する個別の音                       |
| 音名   | オクターヴ番号を含む表記法（例: A4 = 442Hz） |
| cent   | 半音の1/100単位の音程調整                    |

---

# 2. システム構成

## 2.1. 技術スタック
- **フレームワーク**: Next.js (App Router)
- **言語**: TypeScript
- **状態管理**: React useState
- **音声生成**: Web Audio API
- **UIライブラリ**: shadcn/ui

## 2.2. 対応環境

### デスクトップ
- Windows: Google Chrome 最新版

### モバイル
- iOS: Google Chrome 最新版、Safari 最新版
- Android: Google Chrome 最新版

---

# 3. 機能仕様

## 3.1. 基準周波数設定

### 仕様
| 項目         | 内容          |
| ------------ | ------------- |
| 対象音       | A4            |
| デフォルト値 | 442Hz         |
| 入力形式     | numeric input |
| 入力範囲     | 300～500Hz    |

---

## 3.2. 構成音の入力

### 3.2.1. 入力フォーム

**フォーム項目**
| 項目       | 形式           | 選択肢/範囲                          |
| ---------- | -------------- | ------------------------------------ |
| 音名       | ドロップダウン | A, Bb, C, C#, D, Eb, E, F, F#, G, G# |
| オクターヴ | ドロップダウン | 1～6                                 |
| cent調整   | numeric input  | -100～100 (0.1cent単位)              |
| 送信       | button         | 「構成音を追加」                     |

**入力フロー**
1. 音名を選択
2. オクターヴ番号を選択
3. cent数を入力（デフォルト: 0）
4. 「構成音を追加」ボタンをクリック
5. 必要な構成音の数だけ1～4を繰り返す

---

## 3.3. 構成音の管理

### 3.3.1. 表示
- **形式**: リスト表示
- **並び順**: 音高順（低音→高音）

### 3.3.2. 編集
- **方式**: インライン編集
- **編集可能項目**: cent値のみ
- **UI**: numeric input
- **動作**: 値変更時にリアルタイムで音高を更新

### 3.3.3. 削除
- 各構成音に削除ボタンを配置

### 3.3.4. 音量調整
- **方式**: 各構成音ごとに個別スライダー
- **範囲**: 0～100
- **動作**: リアルタイム調整

---

## 3.4. 音声生成

### 3.4.1. 波形選択
- **種類**: 正弦波、矩形波、三角波、ノコギリ波
- **UI**: ドロップダウン
- **スコープ**: 全構成音で共通

### 3.4.2. 再生制御
- **再生ボタン**
  - 構成音が1つ以上存在する場合のみ有効
  - クリックで「停止」ボタンに切り替わる
  - 音声をデバイスのスピーカーから出力
  
- **停止ボタン**
  - クリックで音声出力を停止
  - 「再生」ボタンに切り替わる

### 3.4.3. マスターボリューム
- アプリ内では設定せず、デバイス側で調整

---

## 3.5. プリセット機能

### 3.5.1. 配置
- サイドバーに配置

### 3.5.2. 保存
- **UI要素**
  - プリセット名入力: textarea
  - 保存ボタン: button
- **保存内容**: 基準周波数、全構成音のデータ

### 3.5.3. 読み込み
- **UI要素**
  - プリセット一覧: リスト表示
  - 読み込みボタン: button（各プリセットに配置）
- **動作**: クリックでプリセット内容を現在の設定に反映

### 3.5.4. 削除
- **UI要素**
  - 削除ボタン: button（各プリセットに配置）
- **動作**: プリセットをlocalStorageから削除

---

## 3.6. エラー処理とバリデーション

### 3.6.1. 再生ボタンの制御
- 構成音が0個の場合、再生ボタンを無効化

### 3.6.2. フォームバリデーション
- **タイミング**: 「構成音を追加」ボタンクリック時
- **表示方式**: インラインメッセージ
- **チェック項目**
  - 入力値の範囲チェック
  - 重複する構成音の警告

### 3.6.3. 環境チェック
- Web Audio API非対応環境は想定外

---

## 3.7. UI/UX要件

### デザイン
- UIライブラリ: shadcn/ui
- レスポンシブ対応: あり
- ダークモード: 非対応

---

# 4. データ構造

## 4.1. localStorage保存データ

### 4.1.1. 現在の設定
```typescript
{
  baseFrequency: number,  // A4の周波数（デフォルト: 442）
  notes: Array<{
    noteName: string,     // 音名
    octave: number,       // オクターヴ
    cents: number,        // cent調整値
    volume: number        // 音量 (0-100)
  }>
}
```

### 4.1.2. デフォルト構成音
初回起動時またはlocalStorageが空の場合:
- Bb4: 0 cent
- D4: -13.6 cent
- F4: 2 cent

### 4.1.3. プリセット
```typescript
{
  presets: Array<{
    name: string,
    baseFrequency: number,
    notes: Array<{ noteName, octave, cents, volume }>
  }>
}
```